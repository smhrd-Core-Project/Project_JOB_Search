<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.smhrd.database.FreeBoardMapper">

	<select id="select" resultType="com.smhrd.model.FreeBoardVO">
	 SELECT 
		  b.POST_IDX AS postIdx,
		  b.ID,
		  b.TITLE,
		  b.CONTENT,
		  b.CREATED_AT AS createdAt,
		  b.UPDATED_AT AS updatedAt,
		  b.VIEWS,
		  (
		    SELECT COUNT(*) 
		    FROM TB_FREEBOARD_COMMENT c 
		    WHERE c.POST_IDX = b.POST_IDX
		  ) AS comments,
		  (
		    SELECT COUNT(*) 
		    FROM TB_FREEBOARD_LIKES l 
		    WHERE l.POST_IDX = b.POST_IDX
		  ) AS likes
		FROM TB_FREEBOARD b
	</select>
	
	<select id="Main_select" resultType="com.smhrd.model.FreeBoardVO">
		   SELECT *
		    FROM (
		      SELECT
		        f.*
		      FROM
		        tb_freeboard f
		      ORDER BY
		        f.COMMENTS DESC,
		        f.CREATED_AT DESC
		    )
		    WHERE ROWNUM &lt;= 8
	</select>
	
	
	<insert id="insert" parameterType="com.smhrd.model.FreeBoardVO">
    INSERT INTO tb_freeboard (title, content, views, id, likes, comments)
    VALUES (#{title}, #{content}, #{views}, #{id}, 0, 0)
	</insert>
	
	
	 <select id="selectOne" parameterType="int" resultType="com.smhrd.model.FreeBoardVO">
	    SELECT   
	        b.POST_IDX AS postIdx,
	        b.ID AS id,
	        b.TITLE AS title,
	        b.CONTENT AS content,
	        b.CREATED_AT AS createdAt,
	        b.UPDATED_AT AS updatedAt,
	        b.VIEWS AS views,
	        (
	            SELECT COUNT(*) FROM TB_FREEBOARD_COMMENT c WHERE c.POST_IDX = b.POST_IDX
	        ) AS comments,
	        (
	            SELECT COUNT(*) FROM TB_FREEBOARD_LIKES l WHERE l.POST_IDX = b.POST_IDX
	        ) AS likes
	    FROM TB_FREEBOARD b
	    WHERE b.POST_IDX = #{value}
	</select>

    
	<select id="getPageList" parameterType="map" resultType="com.smhrd.model.FreeBoardVO">
	  SELECT * FROM (
	    SELECT inner_table.*, ROWNUM as rnum
	    FROM (
	      SELECT 
	        POST_IDX AS postIdx,
	        ID,
	        TITLE,
	        CONTENT,
	        CREATED_AT AS createdAt,
	        UPDATED_AT AS updatedAt,
	        VIEWS,
	        LIKES
	      FROM TB_FREEBOARD
	      ORDER BY POST_IDX DESC
	    ) inner_table
	    WHERE ROWNUM &lt;= #{offset} + #{pageSize}
	  )
	  WHERE rnum &gt; #{offset}
	</select>

  <!-- 전체 글 수 조회 -->
  <select id="getCount" resultType="int">
    SELECT COUNT(*) FROM TB_FREEBOARD
  </select>

	</mapper>